<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>每日報表 - {{ day.location.name }} - {{ day.date.strftime('%Y-%m-%d') }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}">

    <style>
        :root {
            /* 控制「帳務核對」和「業績統計」表格，以及簽核欄儲存格的邊框粗細 (設為 0px 可隱藏) */
            --table-border-width: 1px; 

            /* 只控制簽名區下方那條「橫線」的粗細 */
            --signature-line-width: 1px;
        }

        body {
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            font-size: 12pt;
            background-color: #fff;
        }
        .report-container {
            width: 100%;
            max-width: 800px;
            margin: auto;
        }
        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
        }
        .report-table td {
            border: var(--table-border-width) solid #dee2e6;
            padding: 0.6rem;
            vertical-align: middle;
        }
        
        .report-table .currency-col {
            width: 3ch;
            text-align: center;
            padding-right: 0.1rem; 
        }
        .report-table .amount-col {
            width: 10ch;
            text-align: right;
            font-family: 'Courier New', monospace;
            padding-left: 0.1rem;
        }

        /* --- 最終修改點：簽核欄樣式 --- */
        .signature-table {
            width: 100%;
            border-collapse: separate; 
            border-spacing: 10px 0;
            margin-top: 1rem;
            border: var(--table-border-width) solid #dee2e6; /* 主外框 */
            border-radius: 4px; /* 輕微圓角 */
            padding: 5px;
        }
        .signature-table td {
            border: 0; /* 移除所有儲存格的預設邊框 */
            position: relative; /* 為了定位偽元素 */
        }
        /* 使用偽元素繪製可控的垂直分隔線 */
        .signature-table td + td::before {
            content: '';
            position: absolute;
            top: 10%;
            left: -5px; /* 定位在間距的正中間 */
            bottom: 10%;
            width: var(--table-border-width);
            background-color: #dee2e6;
        }

        .signature-table .signature-cell {
            width: 33.33%;
            height: 120px;
            border-bottom: var(--signature-line-width) solid #000;
            text-align: center;
            vertical-align: middle;
        }
        .signature-table .title-cell {
            width: 33.33%;
            text-align: center;
            padding-top: 0.5rem;
        }
        .signature-img {
            max-width: 100%;
            max-height: 110px;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="report-container mt-4">
        <h1 class="text-center">每日營運報表</h1>
        <p class="text-center text-muted">據點：{{ day.location.name }} | 日期：{{ day.date.strftime('%Y-%m-%d') }}</p>
        
        <hr>

        <h3 class="mt-4">帳務核對</h3>
        <table class="report-table">
            <tbody>
                <tr>
                    <td class="label-col">開店準備金</td>
                    <td class="currency-col">$</td>
                    <td class="amount-col">{{ "{:,.0f}".format(day.opening_cash | int) }}</td>
                </tr>
                <tr>
                    <td class="label-col">本日銷售總額</td>
                    <td class="currency-col">$</td>
                    <td class="amount-col">{{ "{:,.0f}".format(day.total_sales | int) }}</td>
                </tr>
                <tr class="fw-bold">
                    <td class="label-col">帳面總額 (A)</td>
                    <td class="currency-col">$</td>
                    <td class="amount-col">{{ "{:,.0f}".format(帳面總額 | int) }}</td>
                </tr>
                <tr class="fw-bold">
                    <td class="label-col">盤點現金合計 (B)</td>
                    <td class="currency-col">$</td>
                    <td class="amount-col">{{ "{:,.0f}".format(day.closing_cash | int) }}</td>
                </tr>
                <tr class="fw-bolder">
                    <td class="label-col">帳差 (B - A)</td>
                    <td class="currency-col {% if 帳差 < 0 %}text-danger{% endif %}">$</td>
                    <td class="amount-col {% if 帳差 < 0 %}text-danger{% endif %}">
                        {{ "{:,.0f}".format(帳差 | int) }}
                    </td>
                </tr>
            </tbody>
        </table>

        <h3 class="mt-4">業績統計</h3>
        <table class="report-table">
            <tbody>
                <tr>
                    <td class="label-col">交易筆數 (顧客總數)</td>
                    <td class="currency-col"></td>
                    <td class="amount-col">{{ day.total_transactions }} 筆</td>
                </tr>
                <tr>
                    <td class="label-col">銷售件數 (商品總數)</td>
                    <td class="currency-col"></td>
                    <td class="amount-col">{{ day.total_items }} 件</td>
                </tr>
            </tbody>
        </table>

        <h3 class="mt-5">簽核欄</h3>
        <table class="signature-table">
            <tbody>
                <tr>
                    <td class="signature-cell">
                        {% if signatures.operator and signatures.operator != 'data:,' %}
                            <img src="{{ signatures.operator }}" class="signature-img">
                        {% endif %}
                    </td>
                    <td class="signature-cell">
                        {% if signatures.reviewer and signatures.reviewer != 'data:,' %}
                            <img src="{{ signatures.reviewer }}" class="signature-img">
                        {% endif %}
                    </td>
                    <td class="signature-cell">
                        {% if signatures.cashier and signatures.cashier != 'data:,' %}
                            <img src="{{ signatures.cashier }}" class="signature-img">
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <td class="title-cell">作業員</td>
                    <td class="title-cell">覆核員</td>
                    <td class="title-cell">出納員</td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>