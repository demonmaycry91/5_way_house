{% extends "base.html" %}
{% from "macros.html" import page_header with context %}

{% block title %}使用者管理{% endblock %}

{% block content %}
{{ page_header(
    title='使用者管理',
    button_url=url_for('admin.add_user'),
    button_text='新增使用者'
) }}

<!-- Flash messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, message in messages %}
<div class="alert alert-{{ category }}">{{ message }}</div>
{% endfor %}
{% endif %}
{% endwith %}

<div class="card">
    <div class="card-body">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>使用者名稱</th>
                    <th>角色</th>
                    <th class="text-end">操作</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>
                        {{ user.username }}
                        {# --- 新增：如果使用者有 google_id，則顯示 Google 符號 --- #}
                        {% if user.google_id %}
                            <span class="ms-2" title="透過 Google 登入">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-google" viewBox="0 0 16 16">
                                    <path d="M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.25C3.216 7.22 3 7.9 3 8.5s.216 1.28.492 1.834C4.14 12.092 5.912 13.5 8 13.5c1.243 0 2.31-.45 3.065-1.2l2.284 2.284A7.689 7.689 0 0 1 8 16c-2.158 0-3.978-.708-5.352-1.915A7.962 7.962 0 0 1 0 8c0-2.158.708-3.978 1.915-5.352A7.962 7.962 0 0 1 8 0c2.158 0 3.978.708 5.352 1.915L11.07 3.998A4.347 4.347 0 0 0 8 3.166C5.912 3.166 4.14 4.578 3.508 6.422A4.7 4.7 0 0 0 3 8.5c0 .6.097 1.18.27 1.714C3.84 11.408 5.617 12.834 8 12.834c1.337 0 2.434-.526 3.21-1.342l2.335 2.335A7.962 7.962 0 0 1 8 16Z"/>
                                </svg>
                            </span>
                        {% endif %}
                    </td>
                    <td>
                        {% for role in user.roles %}
                            <span class="badge bg-secondary">{{ role.name }}</span>
                        {% else %}
                            <span class="text-muted">無</span>
                        {% endfor %}
                    </td>
                    <td class="text-end">
                        <a href="{{ url_for('admin.edit_user', user_id=user.id) }}" class="btn btn-sm btn-warning">編輯</a>
                        <form action="{{ url_for('admin.delete_user', user_id=user.id) }}" method="POST" class="d-inline" onsubmit="return confirm('確定要刪除嗎？');">
                           <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                           <button type="submit" class="btn btn-sm btn-danger">刪除</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}